# Simplepad 功能实现说明

## 项目概述
Simplepad 是一个轻量级的 macOS 文本编辑器，采用 Objective-C 和 Cocoa 框架开发。它提供了基本的文本编辑功能，包括文件操作、文本编辑、格式设置等核心功能。

## 技术架构

### 开发环境
- **操作系统**: macOS 10.15+
- **编程语言**: Objective-C
- **开发框架**: Cocoa Framework
- **构建工具**: CMake 3.20+
- **编译器**: Apple Clang

### 项目结构
```
Simplepad/
├── SimpleTextEditor.m     # 主程序文件
├── CMakeLists.txt         # 构建配置文件
├── Info.plist            # 应用程序配置
└── test_simple_editor.py # 测试脚本
```

## 核心功能实现

### 1. 应用程序生命周期管理

#### 启动流程
```objc
- (void)applicationDidFinishLaunching:(NSNotification *)notification {
    // 1. 创建主窗口
    [self createMainWindow];
    
    // 2. 创建文本视图
    [self createTextView];
    
    // 3. 设置菜单系统
    [self setupMenu];
    
    // 4. 显示窗口
    [self.window makeKeyAndOrderFront:nil];
}
```

#### 窗口创建
- 使用 `NSWindow` 创建主窗口
- 设置窗口标题为 "Simplepad"
- 配置窗口大小和位置
- 启用窗口关闭时终止应用程序

### 2. 文本编辑功能

#### 文本视图配置
```objc
- (void)createTextView {
    // 创建滚动视图
    NSScrollView *scrollView = [[NSScrollView alloc] init];
    
    // 创建文本视图
    self.textView = [[NSTextView alloc] init];
    
    // 配置文本视图属性
    [self.textView setAutoresizingMask:NSViewWidthSizable | NSViewHeightSizable];
    [self.textView setRichText:NO];
    [self.textView setUsesFontPanel:YES];
    
    // 设置文本变化监听
    [[NSNotificationCenter defaultCenter] addObserver:self 
                                             selector:@selector(textDidChange:) 
                                                 name:NSTextDidChangeNotification 
                                               object:self.textView];
}
```

#### 撤销/重做功能
- 集成 `NSUndoManager` 自动管理
- 支持标准快捷键 (Cmd+Z, Cmd+Shift+Z)
- 自动跟踪文本修改历史

### 3. 文件操作功能

#### 新建文件
- 清空当前文本内容
- 重置文档修改状态
- 更新窗口标题

#### 打开文件
```objc
- (IBAction)openFile:(id)sender {
    NSOpenPanel *openPanel = [NSOpenPanel openPanel];
    [openPanel setAllowedFileTypes:@[@"txt", @"text", @"md"]];
    
    if ([openPanel runModal] == NSModalResponseOK) {
        NSString *filePath = [[openPanel URL] path];
        NSString *content = [NSString stringWithContentsOfFile:filePath 
                                                      encoding:NSUTF8StringEncoding 
                                                         error:nil];
        [self.textView setString:content ?: @""];
        self.currentFilePath = filePath;
        self.documentModified = NO;
        [self updateWindowTitleWithModifiedStatus];
    }
}
```

#### 保存文件
- 支持保存到现有文件
- 支持另存为新文件
- 自动处理文件编码 (UTF-8)
- 更新文档修改状态

### 4. 菜单系统

#### 应用程序菜单
- **退出**: 支持快捷键 Cmd+Q
- 集成系统标准的应用程序行为

#### 文件菜单
- **新建**: Cmd+N
- **打开**: Cmd+O  
- **保存**: Cmd+S
- 支持文档修改状态提示

#### 编辑菜单
- **撤销**: Cmd+Z
- **重做**: Cmd+Shift+Z
- **剪切**: Cmd+X
- **复制**: Cmd+C
- **粘贴**: Cmd+V
- **全选**: Cmd+A

#### 格式菜单
- **字体设置**: Cmd+T
- 集成系统字体面板
- 支持实时字体预览

### 5. 文档状态管理

#### 修改状态跟踪
```objc
- (void)textDidChange:(NSNotification *)notification {
    if (!self.documentModified) {
        self.documentModified = YES;
        [self updateWindowTitleWithModifiedStatus];
    }
}
```

#### 窗口标题更新
- 显示当前文件名
- 显示文档修改状态 (* 标记)
- 支持无标题文档

#### 退出前保存提示
```objc
- (NSApplicationTerminateReply)applicationShouldTerminate:(NSApplication *)sender {
    if (self.documentModified) {
        // 显示保存对话框
        // 处理用户选择
    }
    return NSTerminateNow;
}
```

## 技术特色

### 1. 简洁的代码结构
- 单一文件实现所有核心功能
- 清晰的函数分工
- 易于理解和维护

### 2. 标准的 Cocoa 模式
- 遵循 Apple 的人机界面指南
- 使用标准的菜单和对话框
- 集成系统字体面板

### 3. 完整的生命周期管理
- 正确的应用程序启动和终止
- 文档状态跟踪
- 用户交互响应

### 4. 错误处理机制
- 文件操作错误处理
- 内存管理优化
- 异常情况处理

## 测试覆盖

### 单元测试
- 源代码完整性检查
- 编译输出验证
- 应用程序包完整性

### 功能测试
- 文件创建和删除
- 应用程序启动测试
- 进程状态监控

## 性能优化

### 内存管理
- 使用 ARC (Automatic Reference Counting)
- 及时释放不需要的对象
- 避免内存泄漏

### 响应性能
- 异步文件操作
- 优化的文本渲染
- 流畅的用户交互

## 兼容性

### 系统要求
- macOS 10.15 或更高版本
- 64位 Intel 或 Apple Silicon 处理器

### 文件格式支持
- 纯文本文件 (.txt)
- 文本文件 (.text)
- Markdown 文件 (.md)

## 后续开发计划

### 短期目标
- 优化应用程序启动性能
- 增强错误处理机制
- 完善测试覆盖

### 长期目标
- 添加语法高亮功能
- 支持多标签页
- 集成版本控制
- 插件系统支持

## 总结
Simplepad 成功实现了基本的文本编辑功能，具有简洁的代码结构、良好的用户体验和完整的生命周期管理。它为进一步的功能扩展奠定了坚实的基础。